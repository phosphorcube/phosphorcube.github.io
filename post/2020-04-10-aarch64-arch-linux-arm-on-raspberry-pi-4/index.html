<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.92.2">
<meta name=description content="Introduction So you may know about the Raspberry Pi, a single board computer designed for embedded applications and DIY projects. You may also know that some people use them as desktop computers. However, one of the biggest problems when it comes to the Pi 4 is poor 64bit support. There is little to none in mainline and the downstream kernel is a bit old. We won’t be fixing that problem but we will be running Arch Linux on the Pi 4 in 64bit mode, be aware that we are using an older kernel and it’s not the latest mainline support.">
<link rel=stylesheet href=https://alicela1n.github.io/css/normalize.css>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet type=text/css>
<link rel=stylesheet href=https://alicela1n.github.io/css/cayman.f3c6873e1f9e178fed9968e08c595ff493cdd6b39bab53523968d3ddbe3ee563.css>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css integrity=sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js integrity=sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<title>AARCH64 Arch Linux ARM on Raspberry Pi 4 | Alices Digital Notebook</title>
</head>
<body>
<section class=page-header>
<h1 class=project-name>
Alice&rsquo;s Digital Notebook
</h1>
<h2 class=project-tagline>
A little blog site.
</h2>
<nav>
<a href=/ class=btn>Blog</a>
<a href=/about/ class=btn>About</a>
<a href=/index.xml class=btn>RSS</a>
</nav>
</section>
<section class=main-content>
<h1>AARCH64 Arch Linux ARM on Raspberry Pi 4</h1>
<div>
<strong>Publish date: </strong>2020-04-10
</div>
<h1 id=introduction><strong>Introduction</strong></h1>
<p>So you may know about the Raspberry Pi, a single board computer designed for embedded applications and DIY projects. You may also know that some people use them as desktop computers. However, one of the biggest problems when it comes to the Pi 4 is poor 64bit support. There is little to none in mainline and the downstream kernel is a bit old. We won&rsquo;t be fixing that problem but we will be running Arch Linux on the Pi 4 in 64bit mode, be aware that we are using an older kernel and it&rsquo;s not the latest mainline support. Also beware that I am not responsible for any mistakes you make.</p>
<h1 id=tutorial><strong>Tutorial</strong></h1>
<p>First off this is what you need:</p>
<ol>
<li>Raspberry Pi 4</li>
<li>SD card of at least a couple GB, mine is 16GB but 8GB and above should work</li>
<li><a href=http://os.archlinuxarm.org/os/ArchLinuxARM-aarch64-latest.tar.gz>Arch Linux ARM generic arm64 image tar</a></li>
<li><a href=https://osdn.net/projects/manjaro-arm/storage/rpi4/xfce/>Manjaro ARM 64bit image for Raspberry Pi 4</a></li>
<li>Linux</li>
</ol>
<p>Now we can get started!</p>
<ul>
<li>
<p>Partition your SD card with the following layout (can be done using gparted or your preferred tool):</p>
<pre tabindex=0><code>[root@MeltBox code]# fdisk -l /dev/mmcblk0
Disk /dev/mmcblk0: 14.86 GiB, 15931539456 bytes, 31116288 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x6c586e13

Device         Boot  Start      End  Sectors  Size Id Type
/dev/mmcblk0p1        2048   206847   204800  100M  b W95 FAT32
/dev/mmcblk0p2      206848 31115263 30908416 14.8G 83 Linux
[root@MeltBox code]#
</code></pre></li>
<li>
<p>Create filesystems on the SD card</p>
<pre tabindex=0><code># mkfs.ext4 -l ROOT /dev/mmcblk0p2
# mkfs.vfat -F 32 -n BOOT /dev/mmcblk0p1
</code></pre></li>
<li>
<p>Mount the filesystems somewhere</p>
<pre tabindex=0><code># mkdir -p /mnt/sdcard/root
# mkdir -p /mnt/sdcard/boot
# mount /dev/mmcblk0p2 /mnt/sdcard/root
# mount /dev/mmcblk0p1 /mnt/sdcard/boot
</code></pre></li>
<li>
<p>Extract the Arch Linux ARM root filesystem to the SD card</p>
<pre tabindex=0><code># bsdtar -xpf ArchLinuxARM-aarch64-latest.tar.gz -C /mnt/sdcard/root
</code></pre></li>
<li>
<p>Mount the Manjaro image as a loopback device</p>
<pre tabindex=0><code># losetup -fP Manjaro-ARM-xfce-rpi4-20.02.img
# mkdir -p /mnt/loop/root
# mkdir -p /mnt/loop/boot
# mount /dev/loop0p2 /mnt/loop/root
# mount /dev/loop0p1 /mnt/loop/boot
</code></pre></li>
<li>
<p>Copy the Manjaro boot files to SD card</p>
<pre tabindex=0><code># cp -R /mnt/loop/boot/* /mnt/sdcard/boot/
</code></pre></li>
<li>
<p>Copy some firmware files and modules over to SD card</p>
<pre tabindex=0><code># cp -R /mnt/loop/root/usr/lib/modules/* /mnt/sdcard/root/usr/lib/modules/
# cp -R /mnt/loop/root/usr/lib/firmware/* /mnt/sdcard/root/usr/lib/firmware/
</code></pre></li>
<li>
<p>Configure fstab and add the following entries</p>
<pre tabindex=0><code>LABEL=ROOT  /    ext4   rw,relatime   0 1
LABEL=BOOT  /boot   vfat    rw,relatime 0 2
</code></pre></li>
<li>
<p>Unmount everything</p>
<pre tabindex=0><code># umount /dev/loop0p1
# umount /dev/loop0p2
# losetup -v -d /dev/loop0
# rm -r /mnt/loop
# umount /dev/mmcblk0p1
# umount /dev/mmcblk0p2
# rm -r /mnt/sdcard
</code></pre></li>
<li>
<p>Boot it and hope it works</p>
</li>
<li>
<p>Login as <code>alarm, password: alarm</code></p>
</li>
<li>
<p>Connect to ethernet because right now Arch doesn&rsquo;t have the installed wifi packages</p>
</li>
<li>
<p>Use su to login as root, <code>password: root</code></p>
</li>
<li>
<p>Initialize pacman keys and update packages</p>
<pre tabindex=0><code># pacman-key --init
# pacman-key --populate archlinuxarm
# pacman -Syu
</code></pre></li>
<li>
<p>Install wpa_supplicant and dialog</p>
<pre tabindex=0><code># pacman -S wpa_supplicant dialog
</code></pre></li>
<li>
<p>Install the rest of the packages you need and enjoy</p>
</li>
</ul>
<h1 id=notes><strong>Notes</strong></h1>
<ul>
<li>This is NOT mainline, it&rsquo;s the downstream RPF based kernel included in Manjaro ARM</li>
<li>This may NOT fully work, I haven&rsquo;t tested everything</li>
<li>I am NOT responsible for any mistakes you make</li>
<li>This was done for fun and out of curiosity</li>
</ul>
<h1 id=extras><strong>Extras</strong></h1>
<p>Building your own kernel to enable kvm and stuff (will take a long time):</p>
<ul>
<li>
<p>Download Raspberry Pi source tree</p>
<pre tabindex=0><code>$ git clone --depth 1 https://github.com/raspberrypi/linux.git
</code></pre></li>
<li>
<p>Install <code>base-devel</code> and <code>bc</code></p>
<pre tabindex=0><code>$ pacman -S base-devel bc
</code></pre></li>
<li>
<p>cd into kernel source</p>
<pre tabindex=0><code>$ cd linux
</code></pre></li>
<li>
<p>Export Arch and Subarch</p>
<pre tabindex=0><code>$ ARCH=arm64
$ SUBARCH=arm
</code></pre></li>
<li>
<p>Export kernel</p>
<pre tabindex=0><code>$ KERNEL=kernel8
</code></pre></li>
<li>
<p>Make the defconfig</p>
<pre tabindex=0><code>$ make bcm2711_defconfig
</code></pre></li>
<li>
<p>Enable the options you want</p>
<pre tabindex=0><code>$ make menuconfig
</code></pre></li>
<li>
<p>Build the kernel</p>
<pre tabindex=0><code>$ make -j4
</code></pre></li>
<li>
<p>Install the kernel</p>
<pre tabindex=0><code># make modules_install
# cp arch/arm64/boot/dts/*.dtb /boot/
# cp arch/arm64/boot/dts/overlays/*.dtb* /boot/overlays/
# cp arch/arm64/boot/dts/overlays/README /boot/overlays/
# cp arch/arm64/boot/Image /boot/kernel
# sed s/kernel8.img/kernel/g /boot/config.txt
</code></pre></li>
</ul>
<p>Hopefully things like KVM work now!</p>
<footer class=site-footer>
<span class=site-footer-credits>
Made with <a href=https://gohugo.io/>Hugo</a>. Themed by <a href=https://github.com/zwbetz-gh/cayman-hugo-theme>Cayman</a>.
</span>
</footer>
</section>
</body>
</html>